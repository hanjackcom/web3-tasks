# SPL Token Program Makefile

.PHONY: help install build deploy test clean dev stop lint format

# é»˜è®¤ç›®æ ‡
help:
	@echo "SPL Token Program - å¯ç”¨å‘½ä»¤:"
	@echo ""
	@echo "  setup     - å®‰è£…æ‰€æœ‰ä¾èµ–å’Œå·¥å…·"
	@echo "  install   - å®‰è£…Node.jsä¾èµ–"
	@echo "  build     - æ„å»ºAnchorç¨‹åº"
	@echo "  deploy    - éƒ¨ç½²ç¨‹åºåˆ°å½“å‰ç½‘ç»œ"
	@echo "  test      - è¿è¡Œæµ‹è¯•"
	@echo "  dev       - å¯åŠ¨å¼€å‘ç¯å¢ƒ"
	@echo "  clean     - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  lint      - æ£€æŸ¥ä»£ç æ ¼å¼"
	@echo "  format    - æ ¼å¼åŒ–ä»£ç "
	@echo "  validator - å¯åŠ¨æœ¬åœ°éªŒè¯å™¨"
	@echo "  stop      - åœæ­¢æœ¬åœ°éªŒè¯å™¨"
	@echo ""
	@echo "  Dockerå‘½ä»¤:"
	@echo "  docker-build  - æ„å»ºDockeré•œåƒ"
	@echo "  docker-run    - è¿è¡ŒDockerå®¹å™¨"
	@echo "  docker-up     - å¯åŠ¨Docker Compose"
	@echo "  docker-down   - åœæ­¢Docker Compose"
	@echo ""
	@echo "  ä»£å¸ç®¡ç†:"
	@echo "  token-create  - åˆ›å»ºæ–°ä»£å¸"
	@echo "  token-info    - æŸ¥çœ‹ä»£å¸ä¿¡æ¯"

# ç¯å¢ƒè®¾ç½®
setup:
	@echo "ğŸ”§ è®¾ç½®å¼€å‘ç¯å¢ƒ..."
	@echo "æ£€æŸ¥Rustå®‰è£…..."
	@which rustc || (echo "è¯·å…ˆå®‰è£…Rust: https://rustup.rs/" && exit 1)
	@echo "æ£€æŸ¥Solana CLIå®‰è£…..."
	@which solana || (echo "è¯·å…ˆå®‰è£…Solana CLI" && exit 1)
	@echo "æ£€æŸ¥Anchorå®‰è£…..."
	@which anchor || (echo "è¯·å…ˆå®‰è£…Anchor" && exit 1)
	@echo "å®‰è£…Node.jsä¾èµ–..."
	@yarn install
	@echo "é…ç½®Solanaä¸ºæœ¬åœ°ç½‘ç»œ..."
	@solana config set --url localhost
	@echo "âœ… ç¯å¢ƒè®¾ç½®å®Œæˆ!"

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	@yarn install

# æ„å»ºç¨‹åº
build:
	@echo "ğŸ”¨ æ„å»ºç¨‹åº..."
	@anchor build

# éƒ¨ç½²ç¨‹åº
deploy: build
	@echo "ğŸš€ éƒ¨ç½²ç¨‹åº..."
	@anchor deploy

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@anchor test

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	@anchor clean
	@rm -rf node_modules/.cache
	@rm -rf target/

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
dev:
	@echo "ğŸš€ å¯åŠ¨å¼€å‘ç¯å¢ƒ..."
	@echo "è¯·ç¡®ä¿åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œ: make validator"
	@yarn dev

# å¯åŠ¨æœ¬åœ°éªŒè¯å™¨
validator:
	@echo "ğŸ”— å¯åŠ¨Solanaæµ‹è¯•éªŒè¯å™¨..."
	@solana-test-validator --reset

# åœæ­¢æœ¬åœ°éªŒè¯å™¨
stop:
	@echo "ğŸ›‘ åœæ­¢éªŒè¯å™¨..."
	@pkill -f solana-test-validator || true

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” æ£€æŸ¥ä»£ç æ ¼å¼..."
	@yarn lint

# æ ¼å¼åŒ–ä»£ç 
format:
	@echo "âœ¨ æ ¼å¼åŒ–ä»£ç ..."
	@yarn lint:fix

# Dockerå‘½ä»¤
docker-build:
	@echo "ğŸ³ æ„å»ºDockeré•œåƒ..."
	@docker build -t spl-token-program .

docker-run: docker-build
	@echo "ğŸ³ è¿è¡ŒDockerå®¹å™¨..."
	@docker run -p 3000:3000 -p 8899:8899 spl-token-program

docker-up:
	@echo "ğŸ³ å¯åŠ¨Docker Compose..."
	@docker-compose up -d

docker-down:
	@echo "ğŸ³ åœæ­¢Docker Compose..."
	@docker-compose down

# ä»£å¸ç®¡ç†å‘½ä»¤
token-create:
	@echo "ğŸª™ åˆ›å»ºæ–°ä»£å¸..."
	@yarn token:create

token-info:
	@echo "ğŸ“Š æŸ¥çœ‹ä»£å¸ä¿¡æ¯..."
	@yarn token:info

# å¿«é€Ÿå¯åŠ¨å®Œæ•´å¼€å‘ç¯å¢ƒ
quick-start: stop
	@echo "âš¡ å¿«é€Ÿå¯åŠ¨å®Œæ•´å¼€å‘ç¯å¢ƒ..."
	@echo "1. å¯åŠ¨éªŒè¯å™¨..."
	@solana-test-validator --reset &
	@sleep 5
	@echo "2. æ„å»ºå’Œéƒ¨ç½²ç¨‹åº..."
	@make deploy
	@echo "3. å¯åŠ¨å‰ç«¯æœåŠ¡å™¨..."
	@yarn dev

# é‡ç½®ç¯å¢ƒ
reset: stop clean
	@echo "ğŸ”„ é‡ç½®å¼€å‘ç¯å¢ƒ..."
	@rm -f keypair.json mint-address.txt
	@make setup

# æ£€æŸ¥ç¯å¢ƒ
check:
	@echo "ğŸ” æ£€æŸ¥å¼€å‘ç¯å¢ƒ..."
	@echo "Rustç‰ˆæœ¬:"
	@rustc --version
	@echo "Solanaç‰ˆæœ¬:"
	@solana --version
	@echo "Anchorç‰ˆæœ¬:"
	@anchor --version
	@echo "Node.jsç‰ˆæœ¬:"
	@node --version
	@echo "Yarnç‰ˆæœ¬:"
	@yarn --version
	@echo "å½“å‰Solanaé…ç½®:"
	@solana config get

# ç”Ÿäº§éƒ¨ç½²åˆ°devnet
deploy-devnet:
	@echo "ğŸŒ éƒ¨ç½²åˆ°Devnet..."
	@solana config set --url devnet
	@solana airdrop 2
	@anchor deploy --provider.cluster devnet
	@echo "âœ… éƒ¨ç½²åˆ°Devnetå®Œæˆ!"

# ç”Ÿäº§éƒ¨ç½²åˆ°mainnet
deploy-mainnet:
	@echo "âš ï¸  éƒ¨ç½²åˆ°Mainnet..."
	@read -p "ç¡®è®¤è¦éƒ¨ç½²åˆ°Mainnetå—? (y/N): " confirm && [ "$$confirm" = "y" ]
	@solana config set --url mainnet-beta
	@anchor deploy --provider.cluster mainnet-beta
	@echo "âœ… éƒ¨ç½²åˆ°Mainnetå®Œæˆ!"